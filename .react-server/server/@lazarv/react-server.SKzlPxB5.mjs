import{join as k,dirname as U}from"node:path";import{fileURLToPath as X}from"node:url";import S from"node:async_hooks";import{parentPort as F}from"node:worker_threads";import G from"picocolors";function W(t){return t?.replace(/\\/g,"/")}function pe(t){return typeof Deno<"u"?new Uint8Array(t):Buffer.copyBytesFrom(t)}function me(t){return typeof Deno<"u"?new Uint8Array(t.reduce((e,o)=>[...e,...o],[])):Buffer.concat(t)}function Y(t){return typeof Deno<"u"?t():setImmediate(t)}typeof Deno<"u"&&(globalThis.process={env:Deno.env.toObject(),cwd:Deno.cwd,argv:[Deno.execPath(),Deno.mainModule,...Deno.args],exit:Deno.exit,emit:function(){}});W(k(U(X(import.meta.url)),".."));class B{constructor(){this.store=new Map,this.contextMap=new Map,this.hook=S.createHook({init:(e,o,s)=>{this.contextMap.has(s)&&this.contextMap.set(e,this.contextMap.get(s))},destroy:e=>{this.contextMap.delete(e)}}),this.hook.enable()}run(e,o,...s){const n=S.executionAsyncId();this.contextMap.set(n,e);let r;try{r=o(...s)}finally{this.contextMap.delete(n)}return r}enterWith(e){const o=S.executionAsyncId();this.store.set(o,e)}getStore(){const e=S.executionAsyncId();return this.store.get(e)||this.contextMap.get(e)}}let N=F===null;class j{constructor(){typeof S.AsyncLocalStorage<"u"?this.asyncLocalStorage=new S.AsyncLocalStorage:(N&&(console.warn(G.yellow("AsyncLocalStorage is not supported, falling back to async hooks implementation")),N=!1),this.customAsyncLocalStorage=new B)}run(e,o,...s){return this.asyncLocalStorage?this.asyncLocalStorage.run(e,o,...s):this.customAsyncLocalStorage.run(e,o,...s)}enterWith(e){this.asyncLocalStorage?this.asyncLocalStorage.enterWith(e):this.customAsyncLocalStorage.enterWith(e)}getStore(){return this.asyncLocalStorage?this.asyncLocalStorage.getStore():this.customAsyncLocalStorage.getStore()}}const I=globalThis.__react_server_context__=globalThis.__react_server_context__||new j;function m(t){const e=I.getStore();return t?e?.[t]??null:e}function R(t,e){const o=I.getStore(),s=typeof t=="object"?t:{[t]:e};Reflect.ownKeys(s).forEach(n=>{o[n]=s[n]})}const he=Symbol.for("LOGGER_CONTEXT"),ye=Symbol.for("FORM_DATA_PARSER"),Ee=Symbol.for("MAIN_MODULE"),Te=Symbol.for("COLLECT_STYLESHEETS"),w=Symbol.for("HTTP_CONTEXT"),z=Symbol.for("HTTP_STATUS"),_e=Symbol.for("HTTP_HEADERS"),K=Symbol.for("HTTP_OUTLET"),Se=Symbol.for("HTTP_RESPONSE"),ge=Symbol.for("REDIRECT_CONTEXT"),de=Symbol.for("ERROR_BOUNDARY"),Oe=Symbol.for("ERROR_COMPONENT"),Re=Symbol.for("ERROR_CONTEXT"),v=Symbol.for("MEMORY_CACHE_CONTEXT"),V=Symbol.for("CACHE_CONTEXT"),q=Symbol.for("FLIGHT_CACHE"),Q=Symbol.for("HTML_CACHE"),Ce=Symbol.for("CONFIG_ROOT"),be=Symbol.for("CONFIG_CONTEXT"),J=Symbol.for("MANIFEST"),Ae=Symbol.for("ROUTE_MATCH"),Pe=Symbol.for("STYLES_CONTEXT"),we=Symbol.for("ACTION_CONTEXT"),Ne=Symbol.for("RELOAD"),Z=Symbol.for("RENDER"),Me=Symbol.for("RENDER_STREAM"),D=Symbol.for("RENDER_CONTEXT"),M=Symbol.for("RENDER_WAIT"),xe=Symbol.for("PRELUDE_HTML"),Le=Symbol.for("POSTPONE_STATE"),Ie=Symbol.for("IMPORT_MAP"),$=Symbol.for("CACHE_MISS"),x=Symbol.for("CACHE_KEY"),b=globalThis.__react_server_client_components__=globalThis.__react_server_client_components__||new Map,ve=({remote:t,origin:e})=>new Proxy({},{get(o,s){let n=b.get(s);const[r,c="default"]=s.split("#");if(!b.has(s)){const a=m(J);a?n={id:`${t?e:""}/${a.browser[r.replace(/^(?:__\/)+/,f=>f.replace(/__\//g,"../"))]?.file}`,chunks:[],name:c,async:!0}:n={id:r,chunks:[],name:c,async:!0},b.set(s,n)}return n}});function ee(){return m(w).url}const te=Object.getOwnPropertyNames(URL.prototype).filter(t=>{const e=Object.getOwnPropertyDescriptor(URL.prototype,t);return e&&e.set});function De(t){const e=m(w),o=typeof t=="string"?new URL(t,e.url):t;return te.forEach(s=>{e.url[s]=o[s]}),e.url}function oe(){return decodeURIComponent(m(K)??m(D)?.outlet??m(w)?.request?.headers?.get("react-server-outlet")??"PAGE_ROOT").replace(/[^a-zA-Z0-9_]/g,"_")}const L=[];async function He(){for(;L.length>0;)await L.shift().call(null)}function ke(t,e=1/0){return o=>(ne(e),t(o))}function ne(t=1/0){const e=ee(),o=oe(),s=m(V);t===!0&&(t=1/0);const n=Date.now()+t;s.setExpiry([e,"text/x-component",o,q],n),s.setExpiry([e,"text/html",o,Q],n)}function Ue(t=200,e=void 0){R(z,{status:t,statusText:e})}const d=new Map;async function Xe(t,e,o=1/0,s=!1){const n=t.map(c=>c?.toString()).join(":");await new Promise(c=>setImmediate(c));let r;d.has(n)?await d.get(n):d.set(n,new Promise(c=>r=c));try{const c=m(v);let a=await c.get(t);return(s||a===$)&&(a=typeof e=="function"?e():e,await c.setExpiry(t,Date.now()+o),await c.set(t,a)),d.delete(n),r?.(),await a}catch{d.delete(n),r?.()}}function Fe(t){const e=m(v);return typeof t=="function"&&t[x]?e?.delete(t[x]):e?.delete(t)}const O=Symbol("RENDER_LOCK");function Ge(){const t=m(Z),e=m(D),o=e?.flags.isRemote,s=e?.flags.isFunction;return{render:t,lock:r=>{R(O,(m(O)??0)+1);let c;const a=new Promise(f=>{c=()=>{Y(()=>{const p=m(O);R(O,p-1),p===1&&f(M)})}});return R(M,a),r?new Promise(async(f,p)=>{try{await r(),f()}catch(E){p(E)}finally{c()}}):c},isRemote:o,isFunction:s}}const A=new Map,P=new Map;function se(t){if(A.has(t))return A.get(t);const e=[];let o="",s=!1,n=!1,r=0,c,a=0;for(const f of t)f==="{"&&!s?(o&&e.push({type:"static",value:o}),o="{",s=!0):f==="}"&&s?(e.push({type:"escaped",value:o+"}"}),o="",s=!1):f==="["&&!s&&!n?(o&&e.push({type:"static",value:o}),o="[",n=!0,c=a,r++):f==="["&&n?(o+=f,r++):f==="]"&&n?(r--,r===0?(e.push({type:"param",value:o+"]",start:c,end:a+1}),o="",n=!1,c=null):o+=f):f==="/"&&!s&&!n?(o&&e.push({type:"static",value:o}),e.push({type:"separator"}),o=""):o+=f,a++;return o&&e.push({type:"static",value:o}),A.set(t,e),e}function ae(t){if(P.has(t))return P.get(t);const e=se(t),o=[];let s=[];for(const n of e)if(n.type==="separator")s.length&&(o.push(s),s=[]);else if(n.type==="escaped")s.push({type:"static",value:n.value.slice(1,-1)});else if(n.type==="param"){const r=n.value.slice(1,-1);if(r.startsWith("..."))s.push({type:"catchAll",param:r.slice(3),start:n.start,end:n.end});else if(r.startsWith("[...")&&r.endsWith("]"))s.push({type:"optionalCatchAll",param:r.slice(4,-1),start:n.start,end:n.end});else if(r.startsWith("[")&&r.endsWith("]")){const[c,a]=r.slice(1,-1).split("=");s.push({type:"optionalParam",param:c,matcher:a,start:n.start,end:n.end})}else{const[c,a]=r.split("=");s.push({type:"param",param:c,matcher:a,start:n.start,end:n.end})}}else n.type==="static"&&s.push({type:"static",value:n.value});return s.length&&o.push(s),P.set(t,o),o}function We(t,e,o={}){if(t==="*")return{};const s=ae(t),n=e.split("/").filter(Boolean),r={};let c=0,a=0,f=[];for(;c<s.length;){const p=s[c];let E=n[a],T=!0,y={};if(p.length>1){let l=0;for(let i=0;i<p.length;i++){const u=p[i];let _=i+1,h=p[_];for(;h?.type==="param";)h=p[++_];if(u.type==="static"){if(E.slice(l,l+u.value.length)!==u.value)return null;l+=u.value.length}else if(u.type==="param"||u.type==="optionalParam"){const g=h?E?.indexOf(h.value,l)??0:E.length,C=E?.slice(l,g)??"";if(!C&&u.type==="param")return null;if(u.matcher&&typeof o.matchers[u.matcher]=="function"){const H=o.matchers[u.matcher];if(!H(C)){if(u.type==="param")return null;if(u.type==="optionalParam"){T=!1;continue}}}y[u.param]=C,l=g}}a++}else for(const l of p)if(l.type==="static"){if(E!==l.value){T=!1;break}a++}else if(l.type==="param"){if(a>=n.length){T=!1;break}if(l.matcher&&typeof o.matchers[l.matcher]=="function"){const i=o.matchers[l.matcher];if(!i(n[a])){T=!1;break}}y[l.param]=n[a],a++}else if(l.type==="optionalParam")a<n.length&&(!l.matcher||typeof o.matchers[l.matcher]=="function"&&o.matchers[l.matcher](n[a]))&&(f.push(l),y[l.param]=n[a],a++);else if(l.type==="catchAll"||l.type==="optionalCatchAll"){const i=n.slice(a);if(c<s.length-1){const u=s.slice(c+1).find(_=>_.some(h=>h.type==="static"));if(u){const _=u.find(g=>g.type==="static").value,h=i.indexOf(_);if(h!==-1)y[l.param]=i.slice(0,h),a+=h;else if(l.type==="catchAll"){T=!1;break}}else y[l.param]=i,a=n.length}else y[l.param]=i,a=n.length;if(l.type==="catchAll"&&y[l.param].length===0){T=!1;break}}if(T)Object.assign(r,y),c++;else{if(p.some(i=>i.type==="static")&&f.length>0){a--;const i=f.pop();i.type==="optionalParam"&&(r[i.param]=void 0);continue}if(p.every(i=>i.type==="optionalParam"||i.type==="optionalCatchAll"))s.forEach(i=>{r[i.param]=i.type==="optionalCatchAll"?[]:void 0}),c++;else return null}}return o.exact&&a<n.length?null:r}const re=`.react-server-global-error * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }
  
  .react-server-global-error {
    font-family: system-ui, -apple-system, sans-serif;
    line-height: 1.5;
    padding: 1rem;
    background: #fff;
  }
  
  .react-server-global-error h1 {
    font-size: 2rem;
    font-weight: 600;
    margin-bottom: 1rem;
    color: #e11d48;
  }
  
  .react-server-global-error pre {
    margin: 1rem 0;
    padding: 1rem;
    background: #f1f5f9;
    color: #374151;
    border-radius: 0.5rem;
    font-size: 0.875rem;
    width: 100%;
    overflow: auto;
    white-space: pre-wrap;
    word-wrap: break-word;
  }`,Ye=`${re}
  
  .react-server-global-error button {
    padding: 0.5rem 1rem;
    background: #0ea5e9;
    color: white;
    border: none;
    border-radius: 0.25rem;
    cursor: pointer;
  }
  
  .react-server-global-error button:hover {
    background: #0284c7;
  }`;export{we as A,ee as B,be as C,We as D,Oe as E,ye as F,Ue as G,w as H,Ie as I,ne as J,Ge as K,he as L,Ee as M,re as N,Ye as O,xe as P,ke as Q,Me as R,Pe as S,Te as T,J as U,Fe as V,Xe as W,x as X,Ce as a,D as b,ge as c,R as d,q as e,Q as f,m as g,V as h,He as i,$ as j,Ne as k,de as l,_e as m,ve as n,Y as o,M as p,pe as q,De as r,me as s,z as t,oe as u,Se as v,I as w,Le as x,Re as y,Ae as z};
