import{j as d}from"../../../react/jsx-runtime.Bzy84PhA.mjs";import{r as t}from"../../../react.h85BbI97.mjs";import{useClient as S,FlightContext as O,PAGE_ROOT as h,FlightComponentContext as P}from"./context.C11qnkA2.mjs";function L({remote:u=!1,defer:r=!1,request:f,children:m}){const{url:a,outlet:e}=t.useContext(O),g=S(),{registerOutlet:v,subscribe:n,getFlightResponse:o,abort:A}=g,[{resourceKey:E,error:x,Component:R},y]=t.useState({resourceKey:0,error:null,Component:m||(e===h||u?o?.(a,{outlet:e,remote:u,defer:r,request:f}):null)}),p=t.useRef(null),b=t.useRef(null),_=t.useRef(R);if(t.useEffect(()=>{let c=!0;const C=v(e,a),F=n(e||a,async(T,l,K)=>{if(typeof l.Component<"u"){const s=new DOMException("render","AbortError");A(e,s),b.current?.reject(s),y(i=>({...i,resourceKey:i.resourceKey+1,error:p.current,Component:l.Component})),K(null,l.Component);return}let j,w;const D=new Promise((s,i)=>{j=s,w=i,b.current={resolve:s,reject:i}}),G=o(T,{...l,outlet:e,remote:u,request:f,onReady:l.callServer?void 0:j,onAbort:l.callServer?void 0:w});if(l.callServer)K(null,G);else if(c){l.fallback&&t.startTransition(()=>{y(s=>({...s,resourceKey:s.resourceKey+1,error:p.current,Component:l.fallback}))});try{const s=await D;b.current=null,t.startTransition(()=>{y(i=>({...i,resourceKey:i.resourceKey+1,error:p.current,Component:s})),K(null,s)})}catch{b.current=null}}});return()=>{c=!1,C(),F()}},[a,e,u,f,n,o]),t.useEffect(()=>{(m||e!==h&&R)&&y(c=>({...c,resourceKey:c.resourceKey+1,error:p.current,Component:m}))},[m]),t.useEffect(()=>{(u||r)&&o(a,{outlet:e,remote:u,defer:r,request:f,fromScript:!r,onReady:c=>{c&&t.startTransition(()=>y(C=>({...C,resourceKey:C.resourceKey+1,error:p.current,Component:c})))}})},[a,e,u,r,f,o]),t.useEffect(()=>{const c=new AbortController;return window.addEventListener(`__react_server_flight_error_${e}__`,C=>{p.current=C.detail.error},{signal:c.signal}),()=>c.abort()},[e]),x){if(e===h)return d.jsx(P.Provider,{value:{resourceKey:E,error:x},children:_.current});throw x}return _.current=R,d.jsx(P.Provider,{value:{resourceKey:E,error:x},children:R})}function z({url:u,outlet:r=null,remote:f,defer:m,request:a,children:e}){const{navigate:g,abort:v}=S();return d.jsx(O.Provider,{value:{url:u,outlet:r,refresh(n={}){return refresh(r,n)},prefetch(n,o={}){return prefetch(n,{outlet:r,...o})},navigate(n,o={}){return g(n,{outlet:r,...o})},replace(n,o={}){return replace(n,{outlet:r,...o})},abort(n){return v(r,n)}},children:d.jsx(L,{remote:f,defer:m,request:a,children:e})})}export{z as default};
